<div class="presta-title fade-in-up">
<h1>Mon Offre</h1>
<p>
Tous mes services sont modulables, nous pouvons en discuter ensemble et vous choisirez la formule qui vous convient le mieux.
</p>

</br>
<p><strong>1er rendez-vous téléphonique ou visio de découverte offert.</strong></p>
</div>




<% @prestations.each do |prestation| %>



  <!-- Ajout de l'ID unique à chaque carte -->
  <div class="card-presta  w-4/5  rounded-lg shadow-lg bg-white overflow-hidden my-4 cursor-pointer relative"
       id="prestation-<%= prestation.id %>"
       data-type="prestation"
       data-id="<%= prestation.id %>">

    <% if prestation.image.attached? %>
      <%= image_tag prestation.image, class: 'img-presta w-full object-cover', style: 'height: 20rem;' %>
    <% else %>
      <p class="text-gray-600 text-center">No image available</p>
    <% end %>


<div class="text-presta">
    <!-- Titre de la prestation -->
    <div class="px-6">
      <h2><%= prestation.titre %></h2>
    </div>

<div class="px-6">

  <p id="short-description-prestation-<%= prestation.id %>">
    <!-- Suppression des balises HTML et troncature du texte -->
    <%= truncate(strip_tags(prestation.description), length: 200, separator: ' ') %>
    <span id="ellipsis-prestation-<%= prestation.id %>"></span>
  </p>
</div>

<!-- Description complète et prix (initialement cachée) -->
<div class="px-6 hidden" id="full-description-prestation-<%= prestation.id %>">
  <!-- Suppression des balises HTML pour la description complète -->
  <p ><%= simple_format(strip_tags(prestation.description)) %></p>
  <div class="price mt-4">
    <p class="text-xl font-semibold text-gray-800"><%= prestation.prix %> €</p>
  </div>


<!-- Bouton RDV -->
<div class="rdv-button">
  <%= link_to "Prendre RDV", new_rdv_path, class: 'rdv-button' %>
</div>
</div>




    <!-- Icônes de bascule -->
    <div class="arrow-icon absolute bottom-4 right-4">
      <div id="arrow-down-prestation-<%= prestation.id %>" class="arrow">
        <i class="fa-solid fa-chevron-down"></i>
      </div>
      <div id="arrow-up-prestation-<%= prestation.id %>" class="arrow hidden">
        <i class="fa-solid fa-chevron-up"></i>
      </div>
    </div>
  </div>
  </div>
<% end %>

</div>
<div class="rdv-button">
  <%= link_to "Prendre RDV", new_rdv_path, class: 'rdv-button' %>
</div>

<h1>Mes soins</h1>
<% @soins.each do |soin| %>
  <div class="card-presta w-4/5 rounded-lg shadow-lg bg-white overflow-hidden my-4 cursor-pointer relative"
       id="soin-<%= soin.id %>"
       data-type="soin"
       data-id="<%= soin.id %>">
    <% if soin.image.attached? %>
      <%= image_tag soin.image, alt: soin.titre, class: 'img-presta w-full object-cover', style: 'height: 20rem;' %>
    <% else %>
      <p class="text-gray-600 text-center">No image available</p>
    <% end %>
    <div class="text-presta">
      <!-- Titre du soin -->
      <div class="px-6">
        <h2><%= soin.titre %></h2>
      </div>
      <div class="px-6">
        <p id="short-description-soin-<%= soin.id %>">
          <!-- Suppression des balises HTML et troncature du texte -->
          <%= truncate(strip_tags(soin.description), length: 200, separator: ' ') %>
          <span id="ellipsis-soin-<%= soin.id %>"></span>
        </p>
      </div>
      <!-- Description complète et prix (initialement cachée) -->
      <div class="px-6 hidden" id="full-description-soin-<%= soin.id %>">
        <!-- Suppression des balises HTML pour la description complète -->
        <p><%= simple_format(strip_tags(soin.description)) %></p>
        <div class="price mt-4">
          <p class="text-xl font-semibold text-gray-800"><%= strip_tags(soin.prix) %></p>
        </div>
        <!-- Bouton Voir plus -->
     <div class="rdv-button">
  <%= link_to "Prendre RDV", new_rdv_path, class: 'rdv-button' %>
</div>
      </div>
      <!-- Icônes de bascule -->
      <div class="arrow-icon absolute bottom-4 right-4">
        <div id="arrow-down-soin-<%= soin.id %>" class="arrow">
          <i class="fa-solid fa-chevron-down"></i>
        </div>
        <div id="arrow-up-soin-<%= soin.id %>" class="arrow hidden">
          <i class="fa-solid fa-chevron-up"></i>
        </div>
      </div>
    </div>
  </div>
<% end %>

<div class="rdv-button">
  <%= link_to "Prendre RDV", new_rdv_path, class: 'rdv-button' %>
</div>


<h1>Mes accompagnements</h1>

<div class="accompagnements-list">
  <% @accompagnements.each do |accompagnement| %>
    <!-- Ajout de l'ID unique à chaque carte accompagnement -->
    <div class="card-presta w-4/5 rounded-lg shadow-lg bg-white overflow-hidden my-4 cursor-pointer relative"
         id="accompagnement-<%= accompagnement.id %>"
         data-type="accompagnement"
         data-id="<%= accompagnement.id %>">
      <% if accompagnement.image.attached? %>
        <%= image_tag accompagnement.image, alt: accompagnement.titre, class: 'img-presta w-full object-cover', style: 'height: 20rem;' %>
      <% else %>
        <p class="text-gray-600 text-center">No image available</p>
      <% end %>
      <div class="text-presta">
        <!-- Titre de l'accompagnement -->
        <div class="px-6">
          <h2><%= accompagnement.titre %></h2>
        </div>
        <div class="px-6">
          <p id="short-description-accompagnement-<%= accompagnement.id %>">
            <!-- Suppression des balises HTML et troncature du texte -->
            <%= truncate(strip_tags(accompagnement.description), length: 200, separator: ' ') %>
            <span id="ellipsis-accompagnement-<%= accompagnement.id %>"></span>
          </p>
        </div>
        <!-- Description complète et prix (initialement cachée) -->
        <div class="px-6 hidden" id="full-description-accompagnement-<%= accompagnement.id %>">
          <!-- Suppression des balises HTML pour la description complète -->
          <p><%= simple_format(strip_tags(accompagnement.description)) %></p>
          <div class="price mt-4">
            <p class="text-xl font-semibold text-gray-800"><%= accompagnement.prix.to_i %> €</p>
          </div>
          <!-- Bouton RDV -->
          <div class="rdv-button">
            <%= link_to "Prendre RDV", new_rdv_path, class: 'rdv-button' %>
          </div>
        </div>
        <!-- Icônes de bascule -->
        <div class="arrow-icon absolute bottom-4 right-4">
          <div id="arrow-down-accompagnement-<%= accompagnement.id %>" class="arrow">
            <i class="fa-solid fa-chevron-down"></i>
          </div>
          <div id="arrow-up-accompagnement-<%= accompagnement.id %>" class="arrow hidden">
            <i class="fa-solid fa-chevron-up"></i>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <div class="rdv-button">
  <%= link_to "Prendre RDV", new_rdv_path, class: 'rdv-button' %>
</div>


<script>
  document.addEventListener("DOMContentLoaded", function () {
    function toggleDetails(type, id) {
      if (window.innerWidth >= 1024) return; // Ne fonctionne qu'en mode desktop

      const fullDescription = document.getElementById(`full-description-${type}-${id}`);
      const shortDescription = document.getElementById(`short-description-${type}-${id}`);
      const ellipsis = document.getElementById(`ellipsis-${type}-${id}`);
      const arrowDown = document.getElementById(`arrow-down-${type}-${id}`);
      const arrowUp = document.getElementById(`arrow-up-${type}-${id}`);

      if (!fullDescription || !shortDescription || !ellipsis || !arrowDown || !arrowUp) {
        console.warn(`Élément(s) manquant(s) pour ${type} ID: ${id}`);
        return;
      }

      fullDescription.classList.toggle("hidden");
      shortDescription.classList.toggle("hidden");
      arrowDown.classList.toggle("hidden");
      arrowUp.classList.toggle("hidden");
      ellipsis.style.display = fullDescription.classList.contains("hidden") ? "inline" : "none";
    }

    function updateVisibility() {
      document.querySelectorAll(".card-presta").forEach(card => {
        const type = card.dataset.type;
        const id = card.dataset.id;
        const fullDescription = document.getElementById(`full-description-${type}-${id}`);
        const shortDescription = document.getElementById(`short-description-${type}-${id}`);
        const arrowDown = document.getElementById(`arrow-down-${type}-${id}`);
        const arrowUp = document.getElementById(`arrow-up-${type}-${id}`);

        if (!fullDescription || !shortDescription) return;

        if (window.innerWidth >= 1024) {
          fullDescription.classList.remove("hidden");
          shortDescription.classList.add("hidden");
          if (arrowDown) arrowDown.classList.add("hidden");
          if (arrowUp) arrowUp.classList.add("hidden");
        } else {
          fullDescription.classList.add("hidden");
          shortDescription.classList.remove("hidden");
          if (arrowDown) arrowDown.classList.remove("hidden");
          if (arrowUp) arrowUp.classList.add("hidden");
        }
      });
    }

    function attachEventListeners() {
      document.querySelectorAll(".card-presta").forEach(card => {
        card.addEventListener("click", function (event) {
          if (window.innerWidth >= 1024) return;
          if (event.target.closest("a")) return; // Ignore clics sur liens
          const type = this.dataset.type;
          const id = this.dataset.id;
          if (type && id) toggleDetails(type, id);
        });
      });
    }

    updateVisibility();
    attachEventListeners();

    window.addEventListener("resize", () => {
      updateVisibility();
      attachEventListeners();
    });
  });
</script>
